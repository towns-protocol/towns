name = "gateway-worker"
main = "src/index.ts"
compatibility_date = "2023-01-20"
account_id="9840f8a36a817b103e00e29a0e2bad6f"
minify = true

[dev]
ip = "localhost"
port = 8004
local_protocol = "http"

[vars]
ENVIRONMENT = "development"
CF_API = "https://api.cloudflare.com/client/v4/accounts"
IMAGE_SERVICE = "https://images.zion.xyz"
ACCOUNT_ID="9840f8a36a817b103e00e29a0e2bad6f"

# The necessary secrets are:
# AUTH_SECRET
# IMAGE_HASH - cloudflare images account hash
# API_TOKEN - images api token
# for local development, you can add these in .dev.vars
#
# For production, you can add these in the Cloudflare dashboard or run
# `echo <VALUE> | wrangler secret put <NAME>` for each of these
# for staging, the secrets must be deployed behind the staging flag
# `echo <VALUE> | wrangler secret put <NAME> --env staging`
# OR
# Run `echo <VALUE> | wrangler secret put <NAME>` for each of these

# staging routes
# yarn publish:stage
[env.staging]
workers_dev = true
routes = [{ pattern = "gateway-worker-staging.zion.xyz", custom_domain = true }, { pattern = "gateway-worker-staging.towns.com", custom_domain = true }]
vars = { ENVIRONMENT = "staging", CF_API = "https://api.cloudflare.com/client/v4/accounts", IMAGE_SERVICE = "https://images.zion.xyz", ACCOUNT_ID="9840f8a36a817b103e00e29a0e2bad6f"} # [vars] access, not secrets
services = [ {binding = "authz", service = "siwe-worker-staging", environment = "production"} ]
# created with wrangler kv:namespace create "USER" --env staging
kv_namespaces = [{ binding = "USER", id = "2fa6f9d5b3f2411eb7ba3db441ea5e29" }]

# production routes
# yarn publish:prod
[env.production]
routes = [{ pattern = "gateway-worker.zion.xyz", custom_domain = true }, { pattern = "gateway-worker.towns.com", custom_domain = true }]
vars = { ENVIRONMENT = "production", CF_API = "https://api.cloudflare.com/client/v4/accounts", IMAGE_SERVICE = "https://images.zion.xyz", ACCOUNT_ID="9840f8a36a817b103e00e29a0e2bad6f"} # [vars] access, not secrets
services = [ {binding = "authz", service = "siwe-worker-production", environment = "production"} ]
# created with wrangler kv:namespace create "USER" --env production
kv_namespaces = [{ binding = "USER", id = "8b1f2abcf4ca4e56855b7d3774d23612" }]