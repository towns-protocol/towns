<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TypeScript Node.js Client</title>
  </head>
  <body>
    <h1>TypeScript Node.js Client</h1>
    <input type="text" id="urlInput" placeholder="Enter URL" value="/info" />
    <p>For GetStream use /casablanca.StreamService/GetStream</p>
    <p>Response from the Go server:</p>
    <pre id="response"></pre>
    <p>Received headers:</p>
    <pre id="headers"></pre>
    <p>Error info:</p>
    <pre id="errorInfo"></pre>
    <button id="fetchButton">Fetch Data</button>

    <button id="callButton">Call Info on RPC service</button>

    <script type="module">
      import { fetchData, fetchRpcInfo } from "/fetcher.ts";

      const fetchButton = document.getElementById("fetchButton");
      const callButton = document.getElementById("callButton");
      const responseElement = document.getElementById("response");
      const errorInfoElement = document.getElementById("errorInfo");

      async function fetchButtonPressed() {
        try {
          // Set the URL to the Go server's /info path
          const text = await fetchData(
            "http://localhost:5157" + document.getElementById("urlInput").value,
          );
          responseElement.textContent = "Response: " + text;
          errorInfoElement.textContent = "";
        } catch (error) {
          console.error("Error fetching data from the Go server:", error);
          errorInfoElement.textContent =
            "Error: " + JSON.stringify(error, null, 2);
        }
      }

      fetchButton.addEventListener("click", fetchButtonPressed);

      async function callButtonPressed() {
        try {
          // Set the URL to the Go server's /info path
          const text = await fetchRpcInfo("http://localhost:5157");
          responseElement.textContent = "Response: " + text;
          errorInfoElement.textContent = "";
        } catch (error) {
          console.error("Error fetching data from the Go server:", error);
          errorInfoElement.textContent =
            "Error: " + JSON.stringify(error, null, 2);
        }
      }

      callButton.addEventListener("click", callButtonPressed);
    </script>
  </body>
</html>
