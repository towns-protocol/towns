syntax = "proto3";
package casablancapayloads;
option go_package = "casablanca/payloads";


message ChannelMessage {
    message Reaction {
        string ref_event_id = 1;
        string reaction = 2;
    }

    message Edit {
        string ref_event_id = 1;
        Post post = 2;
    }

    message Redaction {
        string ref_event_id = 1;
        optional string reason = 2;
    }

    message Post {
        message Mention {
            string user_id = 1;
            string display_name = 2;
        }
        
        message Content {
            message Text {
                string body = 1;
                repeated Mention mentions = 2;
            }

            message Image {
                message Info {
                    string url = 1;
                    string mimetype = 2;
                    optional int32 size = 3;
                    optional int32 width = 4;
                    optional int32 height = 5;
                }
                string title = 1;
                Info info = 2;
                optional Info thumbnail = 3;
            }

            message GM {
                string type_url = 1;
                optional bytes value = 2;
            }
            
            message BlockTxn {
                string hash = 1;
                string type = 2;
            }
        }
        
        optional string thread_id = 1;
        optional string thread_preview = 2;
        
        oneof content {
            Content.Text text = 101;
            Content.Image image = 102;
            Content.BlockTxn block_txn = 103;
            Content.GM gm = 104;
        }  
    }
    
    oneof payload {
        Post post = 1;
        Reaction reaction = 2;
        Edit edit = 3;
        Redaction redaction = 4;
    }
}