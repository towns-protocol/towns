---
title: Technical Whitepaper
description: "Technical Whitepaper covering Towns Protocol's architecture, cryptographic methodologies, consensus mechanisms, economic model, and governance structure for decentralized communication."
---

### Abstract

Communication underpins every aspect of digital life, yet it remains largely centralized, leaving users dependent on platforms prone to censorship, manipulation, and limited economic participation. The Towns Protocol leverages blockchain technology to redefine digital communication by creating decentralized, secure, and economically integrated community platforms.

Built with a custom appchain (Towns Chain) and Base, Ethereum's scalable Layer 2 solution, Towns Protocol introduces decentralized communication through "Spaces", user-owned and programmable digital communities. Each Space employs smart contracts to manage memberships represented by ERC-721 NFTs, enabling tailored governance, dynamic access control, and economic interactions directly integrated with blockchain financial services.

Towns ensures secure messaging via advanced cryptographic methodologies, including Curve25519 key pairs and Double Ratchet encryption algorithms, safeguarding against censorship, spam, and malicious activities. Nodes within the Towns network validate encrypted messages, achieving consensus through decentralized miniblock production and integrating cryptographic proofs directly onto the blockchain for verifiable immutability and transparency.

An innovative economic model incentivizes robust participation by rewarding node operators, delegators, community referrers, and space owners, aligning ecosystem stakeholders through transparent token economics. Governance of the Towns Protocol is fully on-chain via the Towns Lodge DAO, empowering token holders to propose, discuss, and implement protocol upgrades transparently and democratically.

### Introduction

Communication is the most valuable aspect of the internet, underpinning nearly every facet of digital lifeâ€”from personal interactions and community building to critical business operations. Today, centralized platforms such as Slack, Discord, WhatsApp, Telegram, and WeChat dominate this essential utility, capturing significant economic and social value. Decentralized communication technologies represent an unprecedented opportunity to reclaim a portion of this value, providing more resilient, secure, and user-governed alternatives.

The evolution of internet communication has passed through distinct phases: initially limited to text, it expanded into images, then audio and video, and is now extending to include financial transactions. Blockchain technology uniquely enables the integration of financial primitives directly into communication platforms, significantly enriching interactions and offering new possibilities for digital communities.

With blockchain infrastructure reaching maturity, it is now possible to create decentralized communication applications offering user experiences competitive with centralized services. The Towns Protocol harnesses this technological advancement, providing a robust, scalable platform specifically designed to facilitate decentralized communication.

#### Benefits of Decentralized Communication

The benefits of decentralized communication platforms built on blockchain technology are numerous and impactful:

**Global Decentralization**: Operated by a distributed network of node operators worldwide, Towns ensures resilience against censorship and centralized shutdowns, safeguarding the freedom of digital expression and collaboration.

**Permissionless and Programmable**: Open and programmable infrastructure allows developers and users to innovate freely, unlocking infinite potential applications and extensions without centralized approval.

**Transparent Governance**: With rules and protocols transparently encoded into blockchain smart contracts, governance decisions and operational mechanisms are clear, auditable, and resistant to manipulation.

**User Ownership and Sovereignty**: Users truly own their digital spaces via cryptographic on-chain assets (NFTs), granting them control, transferability, and economic sovereignty over their communities.

**Integration with On-Chain Finance**: Seamlessly merging financial services directly into communication channels enables novel interaction models, including tipping, subscriptions, payments, and complex economic interactions, fostering vibrant digital economies within each decentralized community.

The Towns Protocol addresses the limitations of centralized communication and the constraints of early decentralized attempts by delivering a user-friendly, economically integrated, and censorship-resistant platform designed explicitly for the next generation of internet communities.

### System Design

#### Protocol Architecture

The Towns Protocol employs a decentralized architecture consisting of three primary components:

##### Spaces

Spaces are programmable communication channels that users can deploy and manage onchain. Each Space has a unique contract address, allowing independent operation and governance structures. Key functionalities include customizable membership management, role-based entitlements, and moderation tools, all facilitated through specialized smart contracts deployed on the Base Mainnet, a highly performant Ethereum Layer 2 solution.

##### Memberships

Memberships are implemented as NFTs adhering to the ERC-721 standard, providing proof of membership and granting users specific access rights within Spaces. The supply and pricing of Membership NFTs are configurable by Space owners, allowing for dynamic or fixed pricing models and cross-chain token gating mechanisms. Membership tokens can integrate custom entitlement logic, leveraging on-chain assets or off-chain data via oracles, ensuring flexible and inclusive access control.

##### Nodes

Nodes form the decentralized infrastructure underpinning the Towns network. Managed by a Node Registry deployed on Base, nodes are responsible for validating and propagating encrypted messages across the network. Nodes undergo a rigorous registration and monitoring process to maintain high operational standards, and their performance is continuously evaluated to ensure network reliability and security.

##### Architectural Diagrams

Detailed diagrams illustrating interactions between Spaces, Membership NFTs, and Nodes [TODO]

#### Consensus and Incentive Mechanisms

The Towns Protocol utilizes a decentralized consensus mechanism built upon the Layer 2 blockchain (Towns Chain), designed specifically for scalability and efficiency. Consensus is achieved through synchronized validation and mini-block production managed by Stream Nodes. These nodes validate message events, coordinate on their inclusion into mini-blocks, and achieve consensus through a voting mechanism, ensuring accurate and secure message sequencing.

Incentive mechanisms in the Towns Protocol revolve around clearly defined token economics. Node operators set commission rates deducted from periodic inflationary rewards distributed bi-weekly. Rewards are allocated equally among active operators, adjusted for their set commissions. Remaining rewards are then proportionally distributed to delegators, incentivizing active participation and staking.

Economic incentives extend further to encourage robust node operation and active community participation. Nodes are continually evaluated based on their operational performance and receive rewards based on delegated tokens, ensuring alignment of interests across the network's stakeholders and maintaining overall protocol health and reliability.

### Protocol Specification

#### Operational Mechanics

The operational mechanics of the Towns Protocol delineate a sophisticated interplay between Ethereum-based smart contracts, decentralized node operations, and rigorous data stream validation.

##### Smart Contract Interactions

The Towns Protocol employs Ethereum smart contracts to facilitate decentralized governance and membership management within distinct digital communities, referred to as "Spaces". Each Space can be uniquely configured to enforce customized governance rules and community standards. Membership within these Spaces is represented and managed through minting ERC-721 compliant NFTs, embedding programmable pricing and entitlement logic directly within token metadata.

To enhance secure fund management, the Towns Protocol integrates ERC-6551 token-bound accounts. These accounts securely associate funds and digital assets directly with individual ownership tokens, streamlining secure and transparent resource management.

##### Node Operations

Nodes within the Towns Protocol are responsible for validating, propagating, and securely managing encrypted communications. Each node performs critical entitlement checks alongside rigorous cryptographic verification, thus safeguarding the integrity and authenticity of all messages within the network.

A deterministic approach governs stream allocation, administered by the Stream Registry, leveraging the immutable state provided by the blockchain. Nodes collaboratively coordinate to reach consensus, performing event validation and systematically constructing mini-blocks, which ensures precise and sequential event logging across the network.

##### Data Streaming and Validation

Event-driven communication within the Towns Protocol relies upon encrypted payload transmission. Each event is securely routed via a unique StreamId, directing the data to appropriate node clusters for efficient handling.

Upon receiving events, nodes execute comprehensive validation checks, verifying digital signature authenticity, entitlement permissions, and ensuring coherence with previously validated mini-block hashes. Validated events are subsequently committed locally to node-specific mini-pools. Nodes collectively synchronize these mini-pools into consensus-driven mini-blocks, thus maintaining synchronized state across the decentralized network and guaranteeing resilient data integrity and consistency.

#### Messaging Protocol and Mini Block Production

The message lifecycle in the Towns Protocol involves several distinct stages, each designed to ensure decentralization, security, reliability, and efficiency. The following describes the detailed technical steps:

##### 1. Message Creation (Client-Side)

**Client Initialization:**
Users interact with Towns Protocol via secure client applications. Each client generates and securely stores a pair of Curve25519 cryptographic keys for secure identification and end-to-end encryption of messages.

**Cryptographic Encryption:**
Messages are encrypted using an implementation of the Double Ratchet algorithm combined with AES symmetric encryption.

- **Double Ratchet**: Ensures forward secrecy, message confidentiality, and resilience against compromised keys.
- **AES Symmetric Encryption**: Provides performant, secure encryption for real-time messaging.

##### 2. Message Submission

**Message Format:**
Messages conform to a standardized JSON payload format containing encrypted content, metadata, sender signatures, and intended recipients (space-specific).

```json
{
  "sender": "<sender_public_key>",
  "encrypted_message": "<AES-Double-Ratchet-encrypted_content>",
  "space_id": "<space_contract_address>",
  "timestamp": "<unix_timestamp>",
  "signature": "<sender_signature>"
}
```

**Client-to-Node Submission:**
Clients transmit messages via gRPC-based API calls to Towns Protocol nodes, ensuring efficient, reliable, and structured data exchange.

##### 3. Node Processing and Validation

Upon receiving a message, nodes perform critical validation tasks:

**Membership Verification:**
Nodes query the corresponding Space smart contract on the Towns Chain to verify if the sender possesses the requisite Membership NFT, validating their right to post messages within that space.

**Cryptographic Verification:**
Nodes verify digital signatures using the sender's Curve25519 public key to ensure authenticity and message integrity.

**Content Encryption Validation:**
Nodes verify that the encryption and format adhere to protocol standards.

**Timestamp and Replay Protection:**
Nodes enforce timestamp synchronization thresholds and validate uniqueness of message signatures to prevent replay attacks.

##### 4. Decentralized Miniblock Production

Towns Protocol employs decentralized miniblocks to batch and immutably store validated messages. The process involves:

**Message Aggregation:**
Validated messages are grouped by nodes into miniblocks, each representing short timeframes (typically seconds), ensuring near-real-time messaging.

**Consensus and Agreement (OP-Stack):**
Nodes engage in consensus through OP-Stack's decentralized sequencing mechanism to agree upon the ordering and integrity of miniblocks.

**Miniblock Structure:**
Each miniblock comprises:
- **Header**: Contains metadata such as miniblock height, timestamp, Merkle roots, and signatures.
- **Body**: Contains a sequence of message entries structured in encrypted, validated, serialized form.

Example miniblock representation:

```json
{
  "miniblock_height": 482103,
  "timestamp": 1700000000,
  "message_merkle_root": "<hash>",
  "previous_miniblock_hash": "<hash>",
  "node_signature": "<aggregated_node_signatures>",
  "messages": [
    "<message_hash_1>",
    "<message_hash_2>"
  ]
}
```

**Merkle Proof Construction:**
Messages are organized into Merkle trees within miniblocks, allowing efficient cryptographic proofs of message inclusion, enhancing verifiability and reducing node storage overhead.

##### 5. Miniblock Submission to Towns Chain (L2)

After miniblock creation and consensus, nodes submit Merkle roots and miniblock metadata to the Towns Chain (Layer 2), inheriting Ethereum's strong security guarantees and providing cryptographic proof of immutability.

**Optimistic Rollup Integration:**
Miniblocks are periodically batched and submitted to Ethereum's Layer 1 via optimistic rollups, inheriting robust Ethereum consensus and security.

Mini block production involves randomized node election, consensus through voting, leader-driven event ordering, and mini-block formation and signing.

### Cryptographic Methodologies

Ensuring secure and verifiable communication within the Towns protocol necessitates robust cryptographic methodologies. Towns implements advanced encryption techniques alongside innovative cryptographic proofs, enabling secure messaging, verifiable membership, and assured data integrity across its decentralized infrastructure.

#### Secure Messaging and Membership Verification

All interactions within the Towns protocol leverage end-to-end encryption to protect user communications, enforcing a strict confidentiality model. Nodes within the network handle only ciphertext, while plaintext encryption keys remain securely managed by client-side devices. Two primary cryptographic ratcheting algorithms underpin this security:

**Double Ratchet Algorithm**: Utilized for secure peer-to-peer messaging, Towns employs an implementation derived from the widely-recognized Signal protocol. This ensures forward secrecy and post-compromise security, protecting message confidentiality even if long-term keys are compromised.

**AES-based Cryptographic Ratchet**: Optimized for secure group messaging, this ratchet mechanism manages encryption keys shared amongst group members, ensuring scalability without sacrificing cryptographic security.

Membership verification relies on cryptographic proofs facilitated by a unique device identity system. Each (user, client instance) is linked to a deviceId, representing a securely-stored key pair:

**Curve25519 Peer-to-Peer Encryption Key**: This asymmetric key pair is generated at device initialization. The public key is stored on-chain, while the private key remains on the client device, ensuring the integrity and authenticity of device identity and user membership.

**Curve25519 Fallback Key**: An additional ephemeral key pair complements peer-to-peer encryption, allowing secure establishment of encryption sessions for new device interactions, providing resilience against key compromise.

#### Innovations in Cryptographic Proofs for Data Integrity

To maintain the integrity of data streams within its Layer 2 architecture, the Towns Protocol employs a cryptographically secure checkpointing system through mini-block headers. Each mini-block header includes:

- **Hash of Previous Mini Block**: Establishes a continuous chain of custody for events, allowing verifiable historical integrity.
- **Hashes of Events**: Compact representations ensuring efficient verification and synchronization among nodes.
- **Vote Proofs**: Consensus-derived cryptographic evidence from node participants, validating block authenticity and consensus.
- **Node Signatures**: Digital signatures from elected leader nodes, enhancing security and providing non-repudiable proof of block authenticity.

These mini-block headers are locally stored by participating nodes and broadcasted to clients, empowering independent verification of data integrity and transaction finality. A client or node observing a matching transaction hash with the mini-block header hash can cryptographically affirm transaction immutability and finality.

### Economic Model

The Towns Protocol establishes an economic framework designed to foster sustainable growth and robust community engagement through clearly defined incentive structures and diversified monetization pathways. By aligning economic incentives with protocol participation, Towns ensures the longevity and vibrancy of its decentralized social ecosystem.

#### Incentive Structures

A pivotal aspect of the Towns economic model is its sophisticated incentive structure, aimed at rewarding all key ecosystem participants, ensuring active engagement, and promoting the consistent growth of Spaces.

##### Transaction Fee Distribution

Transaction fees generated through user interactions within a Space are methodically distributed among several critical stakeholders:

- **Space Owners**: A substantial portion of the fees directly compensates Space Owners, incentivizing them to actively manage and cultivate their communities.
- **Towns DAO**: Fees allocated to the Towns DAO support ongoing ecosystem-wide developments, infrastructure upgrades, and governance enhancements through the Towns Lodge.
- **Referrers**: Recognizing the importance of community expansion, referrersâ€”both for Space members and protocol clientsâ€”receive fee shares as a direct incentive for driving growth and adoption.

##### Stake and Reward System

Node Operators and delegators within the Towns Protocol receive periodic rewards based on a transparent, DAO-managed inflationary token model. Rewards are systematically distributed bi-weekly, with Node Operators receiving commissions defined at the time of registration, and delegators sharing the remainder proportionally based on their stake.

#### Sustainability and Monetization

Towns Protocol ensures long-term sustainability by embedding multiple monetization strategies directly within its architecture, empowering community spaces to tailor financial models precisely to their needs and visions.

### Governance

The governance of the Towns Protocol is fully on-chain, leveraging decentralized autonomous organization (DAO) principles to ensure transparent, secure, and community-driven decision-making.

#### Governance Structure

Towns governance is facilitated through the Towns Lodge, which operates via a series of smart contracts deployed on Base. These contracts handle proposal submissions, community voting, and decision implementation, ensuring that all governance activities are transparent and immutable.

##### Key Components

**Token-Based Governance**
The Towns Token (TOWNS) serves as the core governance token. Voting power is proportional to a participant's token holdings, incentivizing active community participation and aligning stakeholders' interests with the protocol's long-term success.

**Proposal Lifecycle**

1. **Submission**: Eligible stakeholders (Space Owners and Node Operators meeting specific activity thresholds) can submit proposals. Proposals must clearly articulate their purpose, demonstrate feasibility, and align with the long-term vision of Towns.

2. **Discussion**: Submitted proposals undergo an open discussion phase, allowing stakeholders to deliberate potential impacts, suggest improvements, and refine proposals for clarity and effectiveness.

3. **Voting**: After the discussion phase, proposals proceed to a voting stage where token holders cast their votes. The outcome is determined by a majority weighted by token holdings.

4. **Implementation**: Approved proposals automatically trigger smart contracts for efficient, transparent implementation of changes or upgrades within the protocol.

##### Special Provisions

- **Subgroup Delegation**: The DAO may delegate specific decisions to subgroups with defined permissions and budget allocations from the primary treasury.
- **On-chain Upgrades**: The DAO retains authority to implement upgrades on any on-chain component, including adjustments to Node Registry requirements, membership fees, and functionalities of core contracts like the Space Factory.

#### Transparency and Auditability

All governance proposals, discussions, voting outcomes, and implementation details are permanently recorded on-chain. This ensures complete transparency and allows continuous auditability, reinforcing trust among stakeholders and preserving the integrity of the governance process.

In summary, the Towns Protocol employs a robust, token-based governance model that emphasizes decentralization, transparency, and community participation, ensuring its continuous evolution and adaptability. 