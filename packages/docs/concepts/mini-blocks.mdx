---
title: "Mini Blocks"
---

# Mini Block Production

Similar to traditional blockchain building, mini blocks ensure data integrity and achieve consensus for ordering valid events in a stream.

Here's how the process works:

 1. **Election of Responsible Node**: A node is elected to construct the mini block based on block number and randomness from `randdao`.
 2. **Initiation of Voting Process**: The elected leader starts voting, where nodes submit hashes of events from their mini-pools.
 3. **Combination of Votes**: The leader selects events present in the majority of mini-pools.
 4. **Authority of the Leader**: The leader determines the order of events within the mini block.
 5. **Formation of Mini Block**: The selected events are combined into the mini block.
 6. **Mini Block Header Creation**: The responsible node generates and signs a header for the mini block.
 7. **Integration into Towns Chain**: The mini block header is integrated into Towns chain and shared with all nodes.
 8. **Request for Missing Events**: Nodes request any missing events they don't have from the mini block.
 9. **Local Storage Update**: Nodes update their storage with the new mini block and remove included mini-pools.
10. **Formation of New Mini-Pool**: Unused events form a new mini-pool for the next round.
11. **Event Effectuation at Block Boundaries**: Events like joins and leaves take effect only at block boundaries to maintain consistent ordering.

This process ensures reliable and transparent mini block production, vital to the protocol's stability.

## **Active Minipool Reconciliation**

The system actively propagates events across stream nodes. When a valid event reaches most nodes, it's almost certain to be included in the block. During StreamService.AddEvent operations, events are forwarded to other stream nodes. If a node sees it's missing an event referenced in a NodeToNode.NewEventInPool message, it fetches it from the sending node.

A node fetches missing events when:

It receives an event hash through NodeToNode.NewEventInPool RPC but doesn't receive the NodeToNode.NewEventReceived RPC after a brief delay.

It receives a miniblock header containing hashes of events missing from its local minipool.

After fetching an event, the node executes the NodeToNode.NewEventReceived server-side workflow.